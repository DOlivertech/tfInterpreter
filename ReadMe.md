# tfInterpreter

tfInterpreter is a python based Terraform Plan Interpreter that gives you clear and conscise explanations of your terraform plans.

# Installation



```
chmod +x tfInterpret.py
```

```
mv tfInterpret.py /usr/local/bin/tfInterpret
```

After adding this to your path you will be able to invoke the interpreter as follows

Replace 'tfplan.txt' with the name of your terraform plan file. Typically this is generated by teeing or writing the output of your terraform plan to a file ${filename}.txt
```
tfinterpret tfplan.txt 
```

# Output

The interpreter will provide a few bits of information.

It will firstly display a message indicating that analysis is underway.
Secondly, it will break the analysis into "chunks". A chunk is an interval of ${TOKEN_LIMIT} relative to the maximum amount of tokens for your particular model. In our case "gpt-3.5-turbo-16k" has about a 16,000 token limit. A token can be - but is not always - a single character. If you are using a different model, modify the "model" value and the variable ${TOKEN_LIMIT} to about half of your maximum tokens.

Current list of models and their max tokens can be found [here](https://help.openai.com/en/articles/5832130-what-s-changed-with-engine-names-and-best-practices).

Each piece of the analysis will be separated and displayed by chunk in the output.

The interpreter will then parse the output and give you a clear identitifcation of what resource changes will occur.

At the end of the chunk output, the interpreter will display the amount of tokens used in a given chunk.

ex.

```
---
Tokens used for this chunk: 1394
---
```


Example TF Plan (fakeplan.txt)

```
module.vpc.aws_vpc.main: Reading...
module.vpc.aws_vpc.main: Read complete after 0s [id=vpc-abc123]
module.vpc.aws_subnet.public: Reading...
module.vpc.aws_subnet.public: Read complete after 0s [id=sub-abc123]

Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
  + create
  - destroy
  ~ update in-place
  <= read (data resources)

Terraform will perform the following actions:

  # module.vpc.aws_vpc.main will be updated in-place
  ~ resource "aws_vpc" "main" {
      ~ enable_dns_support   = true -> false
        id                  = "vpc-abc123"
        tags                = {
            "Name" = "main"
        }
    }

  # module.vpc.aws_subnet.public will be destroyed
  - resource "aws_subnet" "public" {
      - id                  = "sub-abc123" -> null
      - tags                = {
            "Name" = "public"
        }
    }

  # module.vpc.aws_subnet.public2 will be created
  + resource "aws_subnet" "public2" {
      + availability_zone = "us-west-2a"
      + cidr_block        = "10.0.1.0/24"
      + vpc_id            = (known after apply)
      + tags              = {
          + "Name" = "public2"
        }
    }

  # module.iam.aws_iam_role.example will be updated in-place
  ~ resource "aws_iam_role" "example" {
      ~ assume_role_policy    = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Action    = "sts:AssumeRole" -> "sts:AssumeRoleWithWebIdentity"
                        Effect    = "Allow"
                        Principal = {
                            Service = "ec2.amazonaws.com"
                        }
                    },
                ]
                Version   = "2012-10-17"
            }
        )
        id                    = "role-example"
        name                  = "example"
        tags                  = {}
    }

  # module.iam.aws_iam_role_policy.example will be updated in-place
  ~ resource "aws_iam_role_policy" "example" {
      ~ policy = jsonencode(
          ~ {
              ~ Statement = [
                  ~ {
                      ~ Action   = [
                          ~ "logs:CreateLogGroup" -> "logs:CreateLogStream",
                            "logs:CreateLogStream",
                            "logs:PutLogEvents",
                        ]
                        Effect   = "Allow"
                        Resource = "*"
                    },
                ]
                Version   = "2012-10-17"
            }
        )
        id     = "role-policy-example"
        name   = "example"
        role   = "example"
    }

  # module.s3.aws_s3_bucket.example will be created
  + resource "aws_s3_bucket" "example" {
      + bucket = "example"
      + acl    = "private"
      + tags   = {
          + "Environment" = "Test"
        }
    }

  # module.s3.aws_s3_bucket_public_access_block.example will be created
  + resource "aws_s3_bucket_public_access_block" "example" {
      + block_public_acls       = true
      + block_public_policy     = true
      + ignore_public_acls      = true
      + restrict_public_buckets = true
      + bucket                  = (known after apply)
    }

  # module.ec2.aws_instance.example[0] will be created
  + resource "aws_instance" "example" {
      + ami                         = "ami-abc123"
      + instance_type               = "t2.micro"
      + subnet_id                   = (known after apply)
      + vpc_security_group_ids      = (known after apply)
      + tags                        = {
          + "Name" = "example0"
        }
    }

  # module.ec2.aws_instance.example[1] will be updated in-place
  ~ resource "aws_instance" "example" {
      ~ instance_type               = "t2.micro" -> "t2.small"
        id                          = "i-abc123"
        ami                         = "ami-abc123"
        subnet_id                   = "sub-abc123"
        vpc_security_group_ids      = ["sg-abc123"]
        tags                        = {
            "Name" = "example1"
        }
    }

  # module.ec2.aws_instance.example[2] will be destroyed
  - resource "aws_instance" "example" {
      - ami                         = "ami-abc123" -> null
      - instance_type               = "t2.micro" -> null
      - id                          = "i-def456" -> null
      - subnet_id                   = "sub-def456" -> null
      - vpc_security_group_ids      = ["sg-def456"] -> null
      -

```
Command run 

```
tfinterpret fakeplan.txt
```

Output

```
Reading and analyzing your plan output...
The analysis has been split into 1 chunks.
Analyzing chunk 1 of 1...
Chunk 1 of 1:
Resources to be added:
- aws_subnet.public2: A new public subnet named "public2" will be created with the CIDR block of "10.0.1.0/24" in the availability zone "us-west-2a".

Resources to be modified:
- aws_vpc.main: The "enable_dns_support" attribute will be changed from true to false.

Resources to be deleted:
- aws_subnet.public: The existing public subnet "public" with the ID "sub-abc123" will be destroyed.
- aws_instance.example[2]: The existing EC2 instance with the ID "i-def456" and subnet "sub-def456" will be destroyed.

Resources to be modified in-place:
- aws_iam_role.example: The "assume_role_policy" attribute will be updated to use "sts:AssumeRoleWithWebIdentity" instead of "sts:AssumeRole".
- aws_iam_role_policy.example: The "policy" attribute will be updated to include "logs:CreateLogStream" action in addition to "logs:CreateLogGroup" and "logs:PutLogEvents".
- aws_instance.example[1]: The instance type will be changed from "t2.micro" to "t2.small".

---
Tokens used for this chunk: 1394
---
```